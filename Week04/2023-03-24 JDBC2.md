<img src="https://noticon-static.tammolo.com/dgggcrkxq/image/upload/v1566913897/noticon/xbvewg1m3azbpnrzck1k.png" height="15%" width="15%"> <br/>

# 2023-03-24 / JDBC02

ğŸ—“ï¸ ë‚ ì§œâ€â€â€â€â€â€â€â€â€â€â€2023/03/23 

â˜ï¸ ë‚ ì”¨â€â€â€â€â€â€â€â€â€â€â€ğŸŒ¥ï¸  ë¶€ë¶„ì ìœ¼ë¡œ ë§‘ìŒ( 12**Â°C)** 

## 01. SQL ì •ë¦¬

- DML :  SELECT, INSERT, DELETE, UPDATE
- DDL :  CREATE, DROP, ALTER

### 1.1 DDL

### 1.1.1 Table ìƒì„± (CREATE TABLE)

> CREATE TABLE í…Œì´ë¸” ëª… {
> 
> 
> ì»¬ëŸ¼ëª… ì»¬ëŸ¼ íƒ€ì… ì˜µì…˜
> 
> }
> 

```sql
create table visitor (
  id int primary key auto_increment,
  name varchar(15) not null,
  writedate datetime not null,
  memo varchar(100) not null
);
```
</br>

### 1.1.2  Table ì‚­ì œ (DROP TABLE)

> DROP TABLE [í…Œì´ë¸”]
> 
</br>

### 1.1.3 Table ìˆ˜ì • (ALTER TABLE)

- ì»¬ëŸ¼ì„ ì¶”ê°€, ì‚­ì œ, ì†ì„± ë³€ê²½

> ALTER TABLE í…Œì´ë¸” ADD(DROP, ALTER) ì»¬ëŸ¼ëª… ~
>

</br>

### 1.2 DML

### 1.2.1 ë°ì´í„° ì¡°íšŒ (SELECT)

> SELECT  ì»¬ëŸ¼ ëª…, â€¦
> 
> 
> FROM í…Œì´ë¸” ëª…
> 
> WHERE ì¡°ê±´
> 
- executeQuery(â€ ì¿¼ë¦¬ ë¬¸â€) â€”> JDBCì—ì„œ ë°ì´í„° ì¡°íšŒí• ë•Œ ì‚¬ìš© ë©”ì„œë“œ

</br>

### 1.2.2 ë°ì´í„° ì‚½ì… (INSERT)

> INSERT INTO í…Œì´ë¸” ì´ë¦„ (ì»¬ëŸ¼ ëª…1, ì»¬ëŸ¼ ëª…2, â€¦)
> 
> 
>          VALUE ( ê°’1, ê°’2, â€¦)
> 
- executeUpdate(â€ì¿¼ë¦¬ ë¬¸â€) â†’ JDBCì—ì„œ  ë°ì´í„°ì˜ ë³€ê²½ì´ ìˆì„ë•Œ ì‚¬ìš©
</br>

### 1.2.3 ë°ì´í„° ê°±ì‹  (UPDATE)

> UPDATE í…Œì´ë¸” ëª… SET ì»¬ëŸ¼ëª… = ê°’
> 
> 
> WHERE ì¡°ê±´
> 

### 1.2.4 ë°ì´í„° ì‚­ì œ (DELETE)

> DELETE FROM í…Œì´ë¸” WHERE ì¡°ê±´
>

</br>
## JDBC

### 2.1 java.sql.Driver

- DBì™€ ì—°ê²°í•˜ëŠ” Driverë¥¼ ë§Œë“¤ë•Œ ë°˜ë“œì‹œ inplmentsí•´ì•¼í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤


### 2.2 java.sql.connection

- íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ê²°ì •ë³´ë¥¼ ê°€ì§€ëŠ” interface
- DriverManagerë¡œ ë¶€í„° Connectionê°ì²´ë¥¼ ê°€ì ¸ì˜¨ë‹¤. â†’ íŒ©í† ë¦¬ ë©”ì†Œë“œ
- DriverManager.getConnection(url,user,password)

### 2.3 java.sql.Statement

- SQL queryë¬¸ì„ DBì— ì „ì†¡í•˜ëŠ” ë°©ë²•ì„ ì •ì˜í•œ interface
- Connectionì„ í†µí•´ ê°€ì ¸ì˜¨ë‹¤.
- conn.createStatment()

### 2.4 java.sql.ResultSet

- SELECT êµ¬ë¬¸ ì‹¤í–‰ ê²°ê³¼ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì •ì˜í•œ interface
- ResultSet rs = stmt.executeQuery(sql); â†’ ì¿¼ë¦¬ ìˆ˜í–‰
- rs.next() â†’ row í•œì¤„ì„ ë¶ˆëŸ¬ì˜´
- getString() , getInt() â†’ í•œ í–‰ì˜ íŠ¹ì • colì„ ë¶ˆëŸ¬ì˜´

### 2.5 prepareStatment

- ë¯¸ë¦¬ sqlë¬¸ì„ ì¤€ë¹„í•´ ë†“ê³  ì‹¤í–‰ì‹œí‚¤ëŠ” ë°©ë²• â†’ SQLë¬¸ì„ ë¯¸ë¦¬ ì»´íŒŒì¼í•˜ì—¬ ì‹¤í–‰ ì†ë„ ë†’ì„
- ì¿¼ë¦¬ë¬¸ì— â€˜?â€™ ë¥¼ ì‚¬ìš©í•˜ì—¬ ë³€ìˆ˜ ê°’ì„ ë„£ì„ ìˆ˜ ìˆìŒ
- Statement ì„ ìƒì† ë°›ìŒ
    
    ```java
    PreparedStatement pstmt = conn.prepareStatement(â€insert into student values (?,?); //ì¿¼ë¦¬ ì¤€ë¹„
    pstmt.setString(1,name);
    pstmt.setInt(2,score);
    ResultSet rs = pstmt.executeQuery(); // ì¿¼ë¦¬ ì‹¤í–‰
    ```
    

### 2.6 executeUpdate()

- SQL Queryë¬¸ì´  INSERT, DELETE, UPDATEì˜ ê²½ìš°ì— ì‚¬ìš©
- DDL ë¬¸ ì‚¬ìš©

## 03. ê¸°íƒ€

- mediumblob -  ë°”ì´ë„ˆë¦¬ ë°ì´í„° , ì´ë¯¸ì§€ ì €ì¥í• ë•Œ ì“°ëŠ” íƒ€ì…
- equalsIgnoreCase - ëŒ€ì†Œë¬¸ì êµ¬ë¶„í•˜ì§€ ì•Šê³  ë¹„êµ
- fileName.sprit(â€\\.â€) - \\. ì€ .ì˜ íŠ¹ë³„í•œ ì˜ë¯¸ê°€ ì•„ë‹Œ ì¼ë°˜ ë¬¸ìë¡œ ë³´ê² ë‹¤.
- e.printStackTrace(); â†’ ì½œìŠ¤íƒ ì •ë³´ ì¶œë ¥

## Exercise01

<details >
 <summary> ğŸ“œJDBC ì‹¤ìŠµ í¼ì³ë³´ê¸°</summary>
<div markdown="1">

1ï¸âƒ£ **[ ì‹¤ìŠµ 1 ] - Create**

(1) êµ¬í˜„ í´ë˜ìŠ¤ëª… : CreateBookLab

- DB ì„œë²„ì— ì ‘ì†í•œë‹¤.
- ë‹¤ìŒ ì‚¬ì–‘ì˜ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” JDBC í”„ë¡œê·¸ë¨ì„ êµ¬í˜„í•œë‹¤.
    
      í…Œì´ë¸”ëª… : book
      ì»¬ëŸ¼ :  ë„ì„œëª…, ê°€ê²©, ë„ì„œë¶„ë¥˜
       id - ì‹ë³„ê°’, Auto Increment ì ìš© - int
               title - í•œê¸€ê¸°ì¤€ 30ìê¹Œì§€ ì €ì¥í•  ìˆ˜ ìˆê²Œ varchar íƒ€ì… ì‚¬ìš© - varchar(90)
               price - ìˆ«ìë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ìˆ«ìíƒ€ì… - int
               kind - ì˜ë¬¸ê¸°ì¤€ 3ìê¹Œì§€ ì €ì¥í•  ìˆ˜ ìˆê²Œ char íƒ€ì… ì‚¬ìš© - char(3)
                  	b01 - í”„ë¡œê·¸ë˜ë° ì–¸ì–´
      b02 - ì›¹ í”„ë¡œê·¸ë˜ë°
      b03 - ë¹…ë°ì´í„°
      b04 - ë°ì´í„°ë² ì´ìŠ¤
      b05 - ì¸í”„ë¼
    
- ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë˜ë©´ "book í…Œì´ë¸” ìƒì„± ì™„ë£Œ!"ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  ì¢…ë£Œí•œë‹¤.
- ì˜¤ë¥˜ ë°œìƒì‹œì—ëŠ” "ì˜¤ë¥˜ë°œìƒ"ì´ë¼ëŠ” ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•˜ê³  ì½œìŠ¤íƒì •ë³´ë„ ì¶œë ¥í•œë‹¤.

```java
public class CreateBookLab {
	public static void main(String[] args) {
		//DB ì •ë³´ ìƒëµ url,user,passwd
		String sql = "create table book (id int primary key auto_increment, title varchar(90), price int, kind char(3)) ";
		
		try(Connection conn = DriverManager.getConnection(url,user,passwd);
				Statement stmt = conn.createStatement();){
				stmt.executeUpdate(sql);
				System.out.println("book í…Œì´ë¸” ìƒì„± ì™„ë£Œ!");
		}catch(SQLException e ) {
			System.out.println("ì˜¤ë¥˜ë°œìƒ : "+e.getMessage());
			e.printStackTrace();
		}

	}
}
```

</br>

2ï¸âƒ£ **[ ì‹¤ìŠµ 2 ] - Insert**

(2) êµ¬í˜„ í´ë˜ìŠ¤ëª… : InsertBookLab

- DB ì„œë²„ì— ì ‘ì†í•œë‹¤.
- ë„ì„œëª…ê³¼ ê°€ê²©ì„ í‘œì¤€ ì¶œë ¥ìœ¼ë¡œ ì…ë ¥ë°›ê³  ë„ì„œë¶„ë¥˜ ì •ë³´ë¥¼ ì„ íƒí•˜ê²Œ í•˜ì—¬ ì…ë ¥ ì •ë³´ë¥¼ book í…Œì´ë¸”ì— ì €ì¥í•œë‹¤.
- í•œ ë²ˆ ì…ë ¥ì„ ë°›ì€ í›„ì—ëŠ” ê³„ì† ì…ë ¥ì„ ìœˆí•˜ëŠ”ì§€ ë¬¸ì˜í•˜ê³  ì›í•  ë•Œê¹Œì§€ ë°˜ë³µ ì²˜ë¦¬ë˜ë„ë¡ í•œë‹¤.
- ë„ì„œë¶„ë¥˜ì˜ ê²½ìš°ì—ëŠ” ì…ë ¥ëœ ìˆ«ìì— ë”°ë¼ì„œ b01, b02, b03, b04, b05 ì¤‘ì— í•œ ê°œë¥¼ ì…ë ¥í•œë‹¤.
- PreparedStatement ë¥¼ ë°˜ë“œì‹œ ì‚¬ìš©í•œë‹¤.
    
    ë„ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš” :
    ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš” :
    ë„ì„œë¶„ë¥˜ì— ëŒ€í•œ ë„˜ë²„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.
    1. í”„ë¡œê·¸ë˜ë° ì–¸ì–´
    2. ì›¹ í”„ë¡œê·¸ë˜ë°
    3. ë¹…ë°ì´í„°
    4. ë°ì´í„°ë² ì´ìŠ¤
    5. ì¸í”„ë¼
    ì„ íƒ(1~5) :
    
    ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.
    
    ê³„ì† ì…ë ¥í•˜ê² ìŠµë‹ˆê¹Œ?(y/n)
    
- ì¢…ë£Œí•  ë•ŒëŠ” "Xê°œì˜ ë°ì´í„° ì…ë ¥ ì™„ë£Œ!" ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•œë‹¤.

```java
public static void main(String[] args) {
		//DB ì •ë³´ ìƒëµ url,user,passwd
		String sql = "insert into book (title, price, kind) values (?, ?, ?)";

		try (Connection conn = DriverManager.getConnection(url, user, passwd);
				PreparedStatement pstmt = conn.prepareStatement(sql);
				Scanner sc = new Scanner(System.in);) {

			String title;
			int price, num, cnt = 0;
			String check;

			while (true) {
				System.out.print("ë„ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš” : ");
				title = sc.nextLine();
				System.out.print("ê°€ê²©ì„ ì…ë ¥í•˜ì„¸ìš” : ");
				price = Integer.parseInt(sc.nextLine());
				System.out.println("ë„ì„œë¶„ë¥˜ì— ëŒ€í•œ ë„˜ë²„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n" + "1.í”„ë¡œê·¸ë˜ë° ì–¸ì–´\n" + "2. ì›¹ í”„ë¡œê·¸ë˜ë°\n" + "3. ë¹…ë°ì´í„°\n"
						+ "4. ë°ì´í„°ë² ì´ìŠ¤\n" + "5. ì¸í”„ë¼");
				System.out.print("ì„ íƒ(1~5) : ");
				num = Integer.parseInt(sc.nextLine());
				
				if(num>5 || num<1) {
					System.out.println("ì˜ëª»ëœ ì…ë ¥ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ ì£¼ì„¸ìš”");
					continue;
				}
				
				pstmt.setString(1, title);
				pstmt.setInt(2, price);
				pstmt.setString(3, "b0"+num);
				
				pstmt.executeUpdate();

				cnt++;
				System.out.println("ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
				
				System.out.print("ê³„ì† ì…ë ¥í•˜ê² ìŠµë‹ˆê¹Œ? (y/n) : ");
				check = sc.nextLine();

				if (check.equalsIgnoreCase("N") ) {
					System.out.println("\n"+cnt + "ê°œì˜ ë°ì´í„° ì…ë ¥ ì™„ë£Œ!");
					break;
				}
			}

		} catch (Exception e) {
			System.out.println("\nì˜¤ë¥˜ ë°œìƒ" );
			 e.printStackTrace();
		}

	}
}
```

</br>

3ï¸âƒ£ **[ ì‹¤ìŠµ 3 ] - Select**

(3) êµ¬í˜„ í´ë˜ìŠ¤ëª… : SelectBookLab

- ìˆ˜í–‰ì„ ì‹œì‘í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë©”ë‰´ë¥¼ ì¶œë ¥í•œë‹¤.
    1. ëª¨ë‘ ì¶œë ¥í•˜ê¸°
    2. ê°€ê²©ì´ ë†’ì€ ìˆœìœ¼ë¡œ ì¶œë ¥í•˜ê¸°
    3. 20000 ì´ìƒì˜ ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸°
    4. ì›¹ í”„ë¡œê·¸ë˜ë° ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸°
    5. ë°ì´í„°ë² ì´ìŠ¤ì™€ ì¸í”„ë¼ ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸°
    6. ë„ì„œëª…ì— 'ìë°”'ë¥¼ í¬í•¨í•˜ëŠ” ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸°
    6. ë¶„ë¥˜ë³„ ë„ì„œ ê°€ê²©ì˜ í‰ê· ì„ ì¶œë ¥í•˜ê¸°
    
    ì›í•˜ëŠ” ë©”ë‰´ì˜ ë²ˆí˜¸ë¥¼ ì„ íƒ :
    
- ë°˜ë³µ ì²˜ë¦¬í•˜ê²Œ êµ¬í˜„í•œë‹¤.(ê³„ì† ì²˜ë¦¬í•˜ê² ëŠ”ì§€ í”„ë¡¬í”„íŠ¸í•˜ê³  ê³„ì†í•˜ê² ë‹¤ê³  í•˜ë©´ ë©”ë‰´ ì¶œë ¥ë¶€í„° ë°˜ë³µ)
- ê°€ê²©ì€ ì²œë‹¨ìœ„ , ë¥¼ ì¶”ê°€í•˜ê³  'ì›'ì„ ë¶™ì—¬ì„œ ì¶œë ¥í•œë‹¤.
- 1ë²ˆê³¼ 2ë²ˆì€ 4ê°œì˜ ì»¬ëŸ¼ì„ ëª¨ë‘ ì¶œë ¥í•œë‹¤. (ëª¨ë“  í–‰, ëª¨ë“  ì—´)
- 3ë²ˆ, 4ë²ˆ, 5ë²ˆ, 6ë²ˆì€ ë„ì„œì œëª©ê³¼ ê°€ê²©ë§Œ ì¶œë ¥í•œë‹¤.
- 7ë²ˆì€ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥í•œë‹¤.
    
    í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ë„ì„œë“¤ì˜ ê°€ê²© í‰ê· ì€ x,xxxì›ì…ë‹ˆë‹¤.
    ì›¹ í”„ë¡œê·¸ë˜ë° ë„ì„œë“¤ì˜ ê°€ê²© í‰ê· ì€ x,xxxì›ì…ë‹ˆë‹¤.
    ë¹…ë°ì´í„° ë„ì„œë“¤ì˜ ê°€ê²© í‰ê· ì€ x,xxxì›ì…ë‹ˆë‹¤.
    ë°ì´í„°ë² ì´ìŠ¤ ë„ì„œë“¤ì˜ ê°€ê²© í‰ê· ì€ x,xxxì›ì…ë‹ˆë‹¤.
    ì¸í”„ë¼ ë„ì„œë“¤ì˜ ê°€ê²© í‰ê· ì€ x,xxxì›ì…ë‹ˆë‹¤.
    
    ë„ì„œê°€ ì—†ëŠ” ë¶„ë¥˜ì˜ ì •ë³´ëŠ” ì œì™¸í•œë‹¤.
    

```java

public class SelectBookLab {

	public static void main(String[] args) {
		//DB ì •ë³´ ìƒëµ url,user,passwd

		int option;
		String sql = "";
		String check = "Y";

		Scanner sc = new Scanner(System.in);

		do {
			System.out.println("*******************ë©”ë‰´**********************");
			System.out.println("1. ëª¨ë‘ ì¶œë ¥í•˜ê¸°\n" + "2. ê°€ê²©ì´ ë†’ì€ ìˆœìœ¼ë¡œ ì¶œë ¥í•˜ê¸°\n" + "3. 20000 ì´ìƒì˜ ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸° \n"
					+ "4. ì›¹ í”„ë¡œê·¸ë˜ë° ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸°\n" + "5. ë°ì´í„°ë² ì´ìŠ¤ì™€ ì¸í”„ë¼ ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸°\n" + "6. ë„ì„œëª…ì— 'ìë°”'ë¥¼ í¬í•¨í•˜ëŠ” ë„ì„œë“¤ë§Œ ì¶œë ¥í•˜ê¸°\n"
					+ "7. ë¶„ë¥˜ë³„ ë„ì„œ ê°€ê²©ì˜ í‰ê·  ì¶œë ¥í•˜ê¸°\n");
			System.out.println("***********************************************");
			System.out.print("\nì›í•˜ëŠ” ë©”ë‰´ì˜ ë²ˆí˜¸ë¥¼ ì„ íƒ : ");
			option = Integer.parseInt(sc.nextLine());

			if (option < 1 || option > 5) {
				System.out.println("ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”.");
				continue;
			} else {
				sql = inputQuery(option);
			}
			System.out.println();

			// sql ë©”ì„œë“œ í˜¸ì¶œ

			try (Connection conn = DriverManager.getConnection(url, user, passwd);
					Statement stmt = conn.createStatement();
					ResultSet rs = stmt.executeQuery(sql);) {

				if (rs.next()) {
					do {
						printBook(option, rs); // ì¶œë ¥ ë©”ì„œë“œ í˜¸ì¶œ
					} while (rs.next());
				} else {
					System.out.println("ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.");
				}

			} catch (SQLException e) {
				System.out.println("SQLì˜¤ë¥˜ : " + e.getMessage());
			} catch (Exception e) {
				System.out.println(e.getMessage());
			}

			System.out.print("\n\nê³„ì† ì…ë ¥í•˜ê² ìŠµë‹ˆê¹Œ? (y/n) : ");
			check = sc.nextLine();

			System.out.println();
		} while (check.equalsIgnoreCase("Y"));
		System.out.println("ì¢…ë£Œí•˜ê² ìŠµë‹ˆë‹¤.");
		sc.close();
	}

	static String inputQuery(int num) {
		String sql = "";
		switch (num) {
		case 1:
			sql = "select id, title, price, kind  from book";
			break;
		case 2:
			sql = "select  id, title, price, kind from book order by price desc";
			break;
		case 3:
			sql = "select title, price from book where price >= 20000";
			break;
		case 4:
			sql = "select title, price from book where kind = 'b02' ";
			break;
		case 5:
			sql = "select title , price from book where kind = 'b04' or kind = 'b05'";
			break;
		case 6:
			sql = "select title , price from book where title like '%ìë°”%'";
			break;
		case 7:
			sql = "select  kind , format(avg(price),0) avg from book group by kind ";
			break;
		}

		return sql;
	}

	static void printBook(int option, ResultSet rs) throws Exception {
		String[] kindbook = { "í”„ë¡œê·¸ë˜ë° ì–¸ì–´", "ì›¹ í”„ë¡œê·¸ë˜ë°", "ë¹…ë°ì´í„°", "ë°ì´í„° ë² ì´ìŠ¤", "ì¸í”„ë¼" };

		switch (option) {
		case 1:
		case 2:
			System.out.printf("id :  %-3s\ttitle : %-15s\t price : %,d\t  kind : %s \n", rs.getInt("id"),
					rs.getString("title"), rs.getInt("price"), rs.getString("kind"));
			break;
		case 3:
		case 4:
		case 5:
		case 6:
			System.out.printf("title : %-10s\tprice : %,d\n", rs.getString("title"), rs.getInt("price"));
			break;
		case 7:
			int index = Integer.parseInt(rs.getString("kind").substring(2)) - 1;
			System.out.printf("%s ë„ì„œë“¤ì˜ ê°€ê²© í‰ê· ì€ %sì› ì…ë‹ˆë‹¤.\n", kindbook[index], rs.getString("avg"));
			break;
		}
	}

}
```

</div>
</details>
