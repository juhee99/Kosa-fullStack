<img src="https://noticon-static.tammolo.com/dgggcrkxq/image/upload/v1659254245/noticon/rj5wzu8zlbf1ddo2u8hq.png" height="15%" width="15%"> <br/>

# 2023-04-14 / JSP2, MVC

ğŸ—“ï¸ ë‚ ì§œâ€â€â€â€â€â€â€â€â€â€â€2023/04/14 

â˜ï¸ ë‚ ì”¨â€â€â€â€â€â€â€â€â€â€â€ğŸ˜· ëŒ€ì²´ë¡œ íë¦¼ , ë¯¸ì„¸ë¨¼ì§€ ìµœì•…(14Â°C)

## 01. ServletContext

- **ServletContext**
    - Context ëœ» : ì‹¤í–‰í™˜ê²½, ì‹¤í–‰ì—”ì§„, ì‹¤í–‰ ì»¨í…Œì´ë„ˆ
    - ServletContext â†’ ì„œë²„ê°€ ì£½ì„ë•Œ ê¹Œì§€ì˜ runtimeì„ ê°€ì§€ê³  ìˆë‹¤.

### 1.1 ì»¨í…Œì´ë„ˆ

ğŸ’¡ì»¨í…Œì´ë„ˆ : ë°ì´í„°ë¥¼ ë³´ê´€í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” API ë“¤

- ServletContext  : ì„œë²„ê°€ ì¢…ë£Œ ë  ë•Œê¹Œì§€ ìœ ì§€, ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ê°€ ê³µìœ  â€”- application scope
- HttpSession :   ë¸Œë¼ìš°ì €ê°€ ê¸°ë™ë˜ì–´ ìˆëŠ” ë™ì•ˆ ìœ ì§€, í´ë¼ì´ì–¸íŠ¸ ë³„ë¡œ â€”- session scope
- HttpServletRequest : ìš”ì²­ ë™ì•ˆ ìœ ì§€(ìš”ì²­~ì‘ë‹µ ì²˜ë¦¬ ê³¼ì •), í´ë¼ì´ì–¸íŠ¸ ë³„ë¡œ â€”- request scope
- PageContext
- ì»¨í…Œì´ë„ˆë“¤ì˜ ë©”ì„œë“œë“¤ì€ í†µì¼ ë˜ì–´ ìˆë‹¤.
    - setAttribute(â€ì´ë¦„â€,ê°ì²´ëª…);
    - getAttribute(â€ì´ë¦„â€);
    - removeAttribute(â€ì´ë¦„â€)

## 02. ì•¡ì…˜ íƒœê·¸

ğŸ’¡ ì •í•´ì§„ ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” íƒœê·¸ë¡œ 

- <jsp:inclued >
    - jsp í˜ì´ì§€ì˜ ìˆ˜í–‰ ê²°ê³¼ ë‚´ì— ë‹¤ë¥¸ ìì›ì˜ ë‚´ìš© ë˜ëŠ” ìˆ˜í–‰ ê²°ê³¼ë¥¼ í¬í•¨í•œë‹¤.
    
    ```java
    <jsp:include page="greeting.jsp">
       <jsp:param name="country" value="korea" />
    </jsp:include>
    ```
    
- <jsp:forward>
    - ìš”ì²­ëœ JSP ëŒ€ì‹  ë‹¤ë¥¸ ìì›ì˜ ë‚´ìš© ë˜ëŠ” ìˆ˜í–‰ ê²°ê³¼ë¥¼  ëŒ€ì‹  í´ë¼ì´ì–¸íŠ¸ë¡œ ì‘ë‹µ í•œë‹¤.
  - 

## 03. EL(Expression Language)

ğŸ’¡ í‘œí˜„ì‹ íƒœê·¸ êµ¬í˜„ì€ ë”ìš± ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

- ì–´ë”˜ê°€ì— ì €ì¥ë˜ì–´ ìˆëŠ” ë°ì´í„°ë¥¼ êº¼ë‚´ì„œ ì¶œë ¥í•˜ëŠ” ì—­í• 
- ì–´ë–¤ì‹ì˜ ìˆ˜í–‰ ê²°ê³¼ë¥¼ ì¶œë ¥
- ë¬´ì–¸ê°€ë¥¼ í‘œí˜„í•˜ëŠ” ê²ƒì— ì§‘ì¤‘ëœ ê¸°ìˆ ì´ë‹¤.(ì„¤ì • ê¸°ëŠ¥x)

```
<% out.print(request.getParameter("addr")); %> : ì§€ì‹œì
<%= request.getParameter("addr") %> : í‘œí˜„ì‹
${param.addr} : EL
```

### 3.1 ELì˜ ì—°ì‚°ì

```
${200+100} : EL ì—ì„œëŠ” ë§ì…ˆ ì—°ì‚°ìë§Œ ì§€ì›(ë¬¸ìì—´ ë§ì…ˆx)
${100 += 200 += 300 } : ë¬¸ìì—´ ì—°ì‚°ì€ +=
${ 10 eq 10 }  : eq ==    
${ 10 lt 10 }  : lt <
${ 10 gt 10 }  : gt >
${ 10 le 10 }  : le <=
${ 10 ge 10 }  : ge >=
```

### 3.2 EL ë‚´ì¥ ê°ì²´

ğŸ’¡ EL ë§Œì˜ ë‚´ì¥ ê°ì²´ë¥¼ ì´ìš©í•´ì„œ í‘œí˜„í•˜ê³ ì í•˜ëŠ” êµ¬í˜„ì„ í¸í•˜ê²Œ

- elì€ ë³€ìˆ˜ ê°’ì´ ì—†ì–´ë„ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
- elì˜ ë³€ìˆ˜ëŠ” ì–´ë”˜ê°€ì— ì €ì¥ë˜ì–´ ìˆëŠ” ê°ì²´ ì´ë‹¤.
    - (PageContext â†’ HttpServletRequest â†’ HttpSession â†’ ServletContext) ìˆœìœ¼ë¡œ ì°¾ëŠ”ë‹¤ , ê°ì²´ì˜ ìœ ì§€í•˜ëŠ” ì‹œê°„ì´ ì¢ì€ ë²”ìœ„ì—ì„œ í° ë²”ìœ„ ìˆœìœ¼ë¡œ ì°¾ëŠ”ë‹¤.
- param - HTTPì˜ íŒŒë¼ë¯¸í„°ë“¤

```
${ !empty param.message } : empty -> ë¹„ì–´ ìˆìœ¼ë©´
${param.message} == ${param["message"]} : -> param í‘œí˜„ì‹ ë‘ê°œ

<% pageContext.setAttribute("name", "ìë°”");  %>
name ë³€ìˆ˜ì˜ ê°’ : ${name}<br>  : 
pageScope.name ë³€ìˆ˜ì˜ ê°’ : ${pageScope.name}<br>
```

## 04. ê°ì²´ ê³µìœ 

ğŸ’¡ ê°ì²´ì˜ ìŠ¤ì½”í”„ë€ ê°ì²´ê°€ ìƒì„±ë˜ì–´ ìœ ì§€ë˜ëŠ” ê¸°ê°„ì„ ì˜ë¯¸

- pageScope - page ìŠ¤ì½”í”„ì— í¬í•¨ëœ ê°ì²´ë“¤
- requestScope - request ìŠ¤ì½”í”„ì— í¬í•¨ëœ ê°ì²´ë“¤
- sessionScope - session ìŠ¤ì½”í”„ì— í¬í•¨ëœ ê°ì²´ë“¤
- applicationScope - application ìŠ¤ì½”í”„ì— í¬í•¨ëœ ê°ì²´ë“¤

## 05. MVC(Model-View-Controller

ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¡œ ë¶€í„° ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ì„œë¡œ ì˜í–¥ ì—†ì´ ìœ ì§€ë³´ìˆ˜ í•˜ê¸° í¸ë¦¬í•˜ë‹¤.

- (Model)ëª¨ë¸ : ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì •ë³´ë¥¼ ë‹´ë‹¹
    - ì„œë¹„ìŠ¤ ëª¨ë¸ : DB ì—°ë™(DAO),  ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§
    - ë„ë©”ì¸ ëª¨ë¸ :  ì²˜ë¦¬ ê²°ê³¼ë¥¼ ì €ì¥(VO, DTO)
- (View) ë·° : ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ ìš”ì†Œ ë‹´ë‹¹ (ì‘ë‹µ )
- Controller(ì»¨íŠ¸ë¡¤ëŸ¬) : viewì™€ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì˜ ìƒí˜¸ë™ì‘ì„ ê´€ë¦¬( ìš”ì²­)

## Filter

ğŸ’¡ ì›¹ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìš”ì²­í•œ ì›¹ ìì›ë“¤(Servlet ë˜ëŠ” JSP)ì´ ìˆ˜í–‰ë˜ê¸° ì „ ë˜ëŠ” í›„ì— ìˆ˜í–‰ë˜ëŠ” ê°ì²´ë¡œì„œ request ë˜ëŠ” responseì— ì˜í–¥ì„ ì£¼ê±°ë‚˜ ë˜ëŠ” íŠ¹ì • ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.

- javax.servlet.Filter ì¸í„°í˜ì´ìŠ¤ ìƒì†
- init() , doFilter(), destroy() ë¥¼ ì˜¤ë²„ë¼ì´ë”© í•´ì•¼ í•œë‹¤.
    - java8 ë¶€í„° init(), destroy()ëŠ” ë””í´íŠ¸ ë©”ì„œë“œë¡œ ì„ íƒì ìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥í•˜ë‹¤.
    
  ![Filter](https://user-images.githubusercontent.com/55836020/232363071-bc36e5d7-4a9f-4170-a3f7-70602fc462d8.png)
    

```java
@WebFilter(dispatcherTypes = {DispatcherType.REQUEST }
					, urlPatterns = { "/*" })
public class TestFilter implements Filter

public void doFilter(**ServletRequest** req, **ServletResponse** res, FilterChain chain)
																									throws IOException, ServletException {
	//ì›¹ ìì›ì˜ ìˆ˜í–‰ ì „ì— ì²˜ë¦¬í•  ê¸°ëŠ¥
	chain.doFilter(req,res);
	// ì›¹ ìì›ì˜ ìˆ˜í–‰ í›„ì— ì²˜ë¦¬í•  ê¸°ëŠ¥
}
```

- ServletRequest, ServlerRespons ëŠ” HttpServletRequest,HttpServletResponseì˜ ë¶€ëª¨ ê°ì²´
- chain ê°ì²´ëŠ” ê·¸ ë‹¤ìŒì— ìˆ˜í–‰ë  ê°ì²´(filter,servlet) ì •ë³´ë¥¼ ë‹´ê³  ìˆìŒ. â†’ wasê°€ ì•Œë ¤ì¤Œ.

## ê¸°íƒ€

- VO - ë°ì´í„°ê°€ ë³€ê²½ì´ ì—†ì„ ë•Œ, setter ê°€ ì—†ìŒ, getter ìˆìŒ
- DTO - ë°ì´í„° ë³€ê²½ì´ ìˆì„ ë•Œ , setter,getter ìˆìŒ
  


## Exercise01 / canvas

<details>
<summary>ğŸ§§ mvc,jsp ì‹¤ìŠµ í¼ì³ë³´ê¸°</summary>
<div markdown="1">

1ï¸âƒ£ **[ì‹¤ìŠµ 1]**

[4ì›”14ì¼_1.pdf](https://github.com/juhee99/Msa-Dkteckin-fullstack/files/11245610/4.14._1.pdf)

1. lottoForm.html

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>

#clover {
	width : 3%;
	margin-left : 2%;
}

</style>
</head>
<body>
<h1>ë¡œë˜ ë²ˆí˜¸ë¥¼ ë§ì¶° ë³´ì„¸ìš”!!</h1>
<hr>

<form action="/mvc/lotto1" method="get" >
<label>1ë¶€í„° 6ê¹Œì§€ì˜ ìˆ«ìë¥¼ ì…ë ¥ í•˜ì„¸ìš” : </label>
<input type="number" min='0' max='6' name="num" placeholder="ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”." required />
<input id="clover" type="image" src="../edu/images/clover.png" />
</form>
</body>
</html>
```

1. LottoServlet.java

```html
package controller;

import java.io.IOException;
import java.time.LocalTime;
import java.time.format.DateTimeFormatter;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import model.domain.TimeVO;

@WebServlet(name = "lotto1", urlPatterns = { "/lotto1" })
public class LottoServlet1 extends HttpServlet {
	private static final long serialVersionUID = 1L;

	protected void doGet(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		response.setContentType("utf-8");
		int num = request.getParameter("num") == "" ? 0 : Integer.parseInt(request.getParameter("num"));
		int random = (int) ((Math.random()*6)+1);
		
		
		HttpSession session = request.getSession();
		if(session.getAttribute("cnt") == null) {
			session.setAttribute("cnt", new int[1]); // Integer ê°ì²´ë¡œ ë“¤ì–´ê°
		}
		
		int [] count = (int [])session.getAttribute("cnt");
		count[0]++;
		
		System.out.println("ì „ë‹¬ëœ ê°’ :"+num+", ì¶”ì¶œëœ ê°’ : "+random+", ì‘ëª¨ ì‹œë„í•œ íšŸìˆ˜ : "+count[0]);
		
		LocalTime now = LocalTime.now();
		TimeVO vo = new TimeVO(now.getHour() ,now.getMinute());
		request.setAttribute("time", vo);
		
		if(count[0] > 3) {
			request.getRequestDispatcher("/jspexam/impossible.jsp").forward(request, response);
		}
		else if(num == random) {
			request.getRequestDispatcher("/jspexam/sucess.jsp").forward(request, response);
		}else {
			request.getRequestDispatcher("/jspexam/fail.jsp").forward(request, response);
		}

		
	}

}
```

1. success.jsp / fail,impossible ìƒëµ

```html
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
    <%@ page import="model.domain.TimeVO" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Success!!</title>
<style>
h3 {
	color : "#D14D72";
}
</style>
</head>
<body>
<% TimeVO vo = (TimeVO)request.getAttribute("time"); %>
<div>
<h3> ${time.hour}ì‹œ ${time.minute}ë¶„ ë‹¹ì²¨!! ì¶”ì¹´ì¶”ì¹´</h3>
<img src=""/>
</div>
</body>
</html>
```

</div>
</details>
  
  ## ğŸ¤·â€â™€ï¸ **todayâ€™s feeling **

- ì‹¤ìŠµì˜ mvc ì¤‘ DAO ë¶€ë¶„ ë‹¤ì‹œ í™•ì¸í•´ ë³´ê¸° â€”> ë‚˜ì¤‘ jpaë‚˜ mybatis ê³µë¶€í•  ë•Œ ë„ì›€ ë¨.
- ì‘ë…„ springí• ë•Œ ì´í•´ê°€ ë˜ì§€ ì•Šë˜ controllerì˜ ë™ì‘ ë°©ì‹ì´ servletì„ ë°°ìš°ê³  ë‚œ í›„ controllerê°€ servlet ì—­í• ì„ í•œë‹¤ëŠ”ê²ƒì„ ì•Œê²Œë˜ì—ˆë‹¤..
