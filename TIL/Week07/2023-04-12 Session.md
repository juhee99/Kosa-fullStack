<img src="https://noticon-static.tammolo.com/dgggcrkxq/image/upload/v1659254245/noticon/rj5wzu8zlbf1ddo2u8hq.png" height="20%" width="20%"> <br/>

# 2023-04-12 / Session

ğŸ—“ï¸ ë‚ ì§œâ€â€â€â€â€â€â€â€â€â€â€2023/04/12 

â˜ï¸ ë‚ ì”¨â€â€â€â€â€â€â€â€â€â€ğŸ˜· ë§‘ìŒ , ë¯¸ì„¸ë¨¼ì§€ ìµœì•…  (14Â°C)
</br>

## 01. ìƒíƒœ ì •ë³´ ìœ ì§€ ê¸°ìˆ 

ğŸ’¡ ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì›¹ ì„œë²„ì— ì •ë³´ë¥¼ ìš”ì²­í•  ë•Œ ì´ì „ ì ‘ì†ì‹œì˜ ê²°ê³¼ë¬¼(ìƒíƒœì •ë³´)ë¥¼ ì¼ì •ì‹œê°„ ë™ì•ˆ ìœ ì§€í•˜ëŠ” ê²ƒì„ ìƒíƒœì •ë³´ ìœ ì§€ë¼ê³  í•œë‹¤. ìƒíƒœì •ë³´ ìœ ì§€ ë°©ë²•ì€ ì—¬ëŸ¬ ê°€ì§€ê°€ ìˆë‹¤.

### 1.1 Cookie

- ì›¹ ë¸Œë¼ìš°ì €ì— ì €ì¥
- ì¿ í‚¤ì˜ ìˆ˜ëª…ì„ ì œí•œ í•  ìˆ˜ ìˆë‹¤.
- ë³´ì•ˆìƒ ì•ˆì „ í•˜ì§€ ì•ŠìŒ

### 1.2 URL ë¬¸ìì—´ ë’¤ì— ì¶”ê°€ í•˜ëŠ” ë°©ë²•

- GET ë°©ì‹ì— url ë¬¸ìì—´ì— ì¶”ê°€
- ë³´ì•ˆìƒìœ¼ë¡œ ë…¸ì¶œë˜ë„ ìƒê´€ ì—†ëŠ”ê²ƒ

### 1.3 <form>ì˜ hiddeníƒ€ì…

- formíƒœê·¸ì•ˆ inputì˜ íƒ€ì… ì†ì„±ì— hiddenìœ¼ë¡œ ì„¤ì • í•˜ì—¬ ì‚¬ìš©ìì—ê²ŒëŠ” ì•ˆë³´ì´ì§€ë§Œ ë°ì´í„°ëŠ” ì„œë²„ë¡œ ì „ë‹¬ëœë‹¤.

### 1.4 HTTP Session

- ì„œë²„ì— ì €ì¥í•˜ëŠ” ë°©ë²• â†’ ë³´ì•ˆì„±
- ë‹¨ : server overhead ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

### 1.5 ë¡œê·¸ì¸ ê³¼ì •

- sessionê°ì²´ê°€ ë§Œë“¤ì–´ ì§ˆë•Œ ê³ ìœ  idê°€ ë§Œë“¤ì–´ ì§€ë©° ì´ idë¥¼ ì¿ í‚¤ì— ì €ì¥í•˜ì—¬ ì‹ë³„ìë¡œ ì‚¬ìš©
- ìš”ì²­í•  ë•Œ ë§ˆë‹¤ ì¿ í‚¤ì˜ session id ë¥¼ ìš”ì²­ í—¤ë“œë¡œ ì„œë²„ì— ë³´ë‚¸ë‹¤.
- ì„œë²„ëŠ” session ìœ íš¨ì„± ì²´í¬ í›„ ì‘ë‹µ


## 02. HttpSession ê°ì²´

- ìƒíƒœ ì •ë³´ëŠ” ê°ì²´ë¡œ ë§Œë“¤ì–´ì„œ ì„œë²„ì— ë³´ê´€í•œë‹¤.
- ìƒíƒœ ì •ë³´ê°€ ìœ ì§€ë˜ëŠ” ìµœëŒ€ ì‹œê°„ì€ ìš”ì²­ì„ ë³´ë‚´ì˜¨ ë¸Œë¼ìš°ì €ê°€ ê¸°ë™ë˜ì–´ ìˆëŠ” ë™ì•ˆì´ë‹¤.
- HttpSession ê°ì²´ê°€ ìƒì„±ë  ë•Œ ì„¸ì…˜IDê°€ í•˜ë‚˜ ë¶€ì—¬ë˜ë©° ì„¸ì…˜ IDëŠ” ìš”ì²­ì„ ë³´ë‚¸ ë¸ŒëŸ¬ìš°ì €ì— `ì¿ í‚¤` ê¸°ìˆ ë¡œ ì €ì¥ëœë‹¤.
- í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì¼ì •ì‹œê°„ ë™ì•ˆ ìš”ì²­ì´ ì—†ëŠ” ê²½ìš°(Inactive Interval Time : ê¸°ë³¸ 30ë¶„) HttpSessionê°ì²´ëŠ” ë” ì´ìƒ ì‚¬ìš© ë¶ˆê°€í•˜ë‹¤.

### 2.1 êµ¬í˜„ ë°©ë²•

1. HttpSession session = request.getSession(); 
    - íŒ©í† ë¦¬ ë©”ì†Œë“œ
2. session.setAttribute(â€xxxâ€, new Date()) ;
    - ë³´ê´€í•˜ë ¤ëŠ” ì •ë³´ë¥¼ ê°ì²´ë¡œ ë§Œë“¤ì–´ sessionì— ì €ì¥
    - xxxë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ê°ì²´ì˜ ì°¸ì¡° ê°’ì„ ë³´ê´€
3. session.getAttribute(â€xxxâ€);
    - xxxë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë³´ê´€ëœ ê°ì²´ì— ëŒ€í•œ `ì°¸ì¡° ê°’`ì„ ë¦¬í„´
4. session.removeAttribute(â€xxxâ€) 
    - xxxë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ë³´ê´€ëœ ê°ì²´ì— ëŒ€í•œ ì°¸ì¡° ê°’ì„ ì‚­ì œ
5. session.invalidate() : session ê°ì²´ë¥¼ ê°•ì œë¡œ ì‚­ì œí•œë‹¤,

### 2.2 ì£¼ìš” ë©”ì„œë“œ

- getId() : ì„¸ì…˜ IDë¥¼ ë¦¬í„´
- getLastAccessedTime() : ìš”ì²­ì´ ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹œë„ëœ ì‹œê°„
- getMaxInactiveInterval() :  ìš”ì²­ì´ ì—†ì„ ë•Œ í˜„ì¬ ì„¸ì…˜ì„ ì–¼ë§ˆ ë§Œí¼ ìœ ì§€ í• ì§€ ì´ˆì‹œê°„ ë‹¨ìœ„ë¡œ ë¦¬í„´
- setMaxInactiveInterval(int seconds) : ì„¸ì…˜ ìœ ì§€ ì‹œê°„ ì„¤ì •
- inNew() : ì„œë²„ì¸¡ì—ì„œ ìƒˆë¡œìš´ ì„¸ì…˜ì„ ìƒì„±í•œ ê²½ìš° true ë¦¬í„´



## 03. MIME type ë¬¸ìì—´

ğŸ’¡ response ë¡œ ì „ë‹¬í•  íƒ€ì…ì„ ì •í•  ë•Œ `response.setContentType("MIME type;charset=utf-8");` ë¡œ ì„¤ì •í•œë‹¤.

- majortype/minortype â€”> MIME type ë¬¸ìì—´
    - text/html   : html
    - text/xml     : xml
    - application/json(text/json)  : json
    - image/gif , image/png, image/jpg  : image
    - text/plain      : ì¼ë°˜ í…ìŠ¤íŠ¸
    

> PrintWriter out = response.getWriter(); // ì‘ë‹µì„ ë‚´ë³´ë‚´ëŠ” ê°ì²´
> 
> 
> out.close() â†’ ìŠì§€ ë§ê¸°!!
>


## ê¸°íƒ€

- chromeì€ ì—¬ëŸ¬ ì°½ì„ ë„ì–´ë„ ëª¸í†µì„ í•˜ë‚˜ë¡œ ê³µìœ í•˜ê³  ìˆì–´ ì •ë³´ë“¤ì´ ê³µìœ  ëœë‹¤.
    - ê³µìœ í•˜ê¸° ì‹«ë‹¤ë©´ ìƒˆ ì‹œí¬ë¦¿ì°½ ìœ¼ë¡œ ë„ìš´ë‹¤.
- ê°ì²´ëŠ” ì°¸ì¡° ê°’ìœ¼ë¡œ ì£¼ê³  ë°›ëŠ”ë‹¤. â€”> session.getAttribute(â€`ì°¸ì¡° ê°’`â€); â†’ ë¦¬í„´ë„ ì°¸ì¡° ê°’(Object)







## Exercise01 / redirect,forward

<details>
<summary>ğŸ“œredirect,forward ì‹¤ìŠµ í¼ì³ë³´ê¸°</summary>
<div markdown="1">

1ï¸âƒ£ **[ì‹¤ìŠµ 1]**

- reservation.html
- ì˜ˆì•½ì ëª… ,ì˜ˆì•½ì•”í˜¸ ,ë£¸ ì„ íƒ, ì¶”ê°€ ìš”ì²­ ì‚¬í•­, ì˜ˆì•½ ë‚ ì§œ form êµ¬ì„±

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Reservation System</title>
<style>

@font-face {
     font-family: 'S-CoreDream-3Light';
     src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/S-CoreDream-3Light.woff') format('woff');
     font-weight: normal;
     font-style: normal;
}

body {
	margin: 0 auto;
	text-align:center;
	height : 100vh;
	background: url('https://cdn.bhdw.net/im/red-flowers-and-a-rainbow-appearing-in-a-cloudy-sky-wallpaper-97199_w635.webp') no-repeat center;
	background-size : cover; 
}

h1 {
	font-family: 'S-CoreDream-3Light';
	font-weight:bolder;
	padding : 10px;
	
}

.formContainer {
	display: flex;
	padding : 10px;
	font-family: 'S-CoreDream-3Light';
	border-radius : 30px;
	flex-direction: column;
	margin : 0 20% 0 20%;
}

.inputContainer{
	padding : 10px;
}

</style>
</head>
<body>
	<h1>íœì…˜ ì˜ˆì•½ ì„œë¹„ìŠ¤</h1>
	<hr>
	<div class="formContainer">
		<form action="/edu1/reservation" method="post" >
			<div class="inputContainer">
			<label for="client">ì˜ˆì•½ìëª… : </label>
			<input type="text" id="client"name="client" /> 
			</div>
			
			<div class="inputContainer">
			<label for="pwd">ì˜ˆì•½ì•”í˜¸ : </label>
			<input type="password" id="pwd" name="pwd" />
			</div>
			
			<div class="inputContainer">
			<label>ë£¸ ì„ íƒ : </label>
			<input type="radio" id="dooly" name="room" value="ë‘˜ë¦¬" /> 
			<label for="dooly">ë‘˜ë¦¬</label>
			<input type="radio" id="heedong" name="room" value="í¬ë™" />
			<label for="heedong">í¬ë™</label>
			<input type="radio" id="donner" name="room" value="ë„ìš°ë„ˆ" />
			<label for="donner">ë„ìš°ë„ˆ</label>
			<input type="radio" id="ddochi" name="room" value="ë˜ì¹˜" />
			<label for="ddochi">ë˜ì¹˜</label>
			</div>
			
			<div class="inputContainer">
			<label>ì¶”ê°€ìš”ì²­ì‚¬í•­ : </label>
			<input type="checkbox" id="barbeque" name="option" value="ë°”ë² í"/>
			<label id="barbeque">ë°”ë² í</label>
			<input type="checkbox" id="swiming" name="option" value="ìˆ˜ì˜ì¥"/>
			<label id="barbeque">ìˆ˜ì˜ì¥</label>
			<input type="checkbox" id="fishing" name="option" value="ë‚šì‹œ"/>
			<label id="fishing">ë‚šì‹œ</label>
			<input type="checkbox" id="branch" name="option" value="ì¡°ì‹"/>
			<label id="branch">ì¡°ì‹</label>
			</div>
			
			<div class="inputContainer">
			<label id="date">ì˜ˆì•½ ë‚ ì§œ :</label>
			<input type="date" id="date" name="date"/>
			</div>
			
			<div class="inputContainer">
			<button type="submit">ë³´ë‚´ê¸°</button>
			<button type="reset">ë‹¤ì‹œ ì‘ì„±í•˜ê¸°</button>
			</div>
		</form>
	</div>
</body>
</html>
```

- ReservationServlet
- ë§¤í•‘ëª… : /reservation
- Post ë°©ì‹
- ì‚¬ìš©ìì˜ ì˜ˆì•½ í˜„í™©ì„ ë³´ì—¬ì£¼ëŠ” í™”ë©´ê³¼ ì˜ˆì•½ ì…ë ¥ í™”ë©´ ëŒì•„ê°€ëŠ” ê¸°ëŠ¥
- ë§Œì•½ ì˜ˆì•½ìëª…ì´ ì—†ìœ¼ë©´ first.htmlë¡œ ì•”í˜¸ê°€ ë¹„ì–´ ìˆìœ¼ë©´ ë‹¤ìŒ í˜ì´ì§€ë¡œ

```java
@WebServlet(name = "reservation", urlPatterns = { "/reservation" })
public class ReservationServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
	
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		response.setContentType("text/html;charset=utf-8"); // ë§¨ ì•ì— ì™€ì•¼í•¨!
		PrintWriter out = response.getWriter();
		request.setCharacterEncoding("utf-8"); // post ë°©ì‹ì€ ì¶”ê°€ë¡œ í•´ì•¼í•¨!
		
		String client = request.getParameter("client");
		String password = request.getParameter("pwd");
		String room = request.getParameter("room");
		String date = request.getParameter("date");
		String [] options = request.getParameterValues("option");
		
		// ì¶”ê°€ ì˜µì…˜ ì²˜ë¦¬
		String str = "ì—†ìŒ";
		if(options != null) {
			str=String.join(" ,",options);
		}
		
		//Date ì²˜ë¦¬;
		if( !date.isBlank() ) {
			String [] result = date.split("-");
			date = result[0]+"ë…„"+result[1]+" ì›”"+result[2]+" ì¼";
		}
	
		if(client == null  || client.isBlank()) {
			RequestDispatcher rd = request.getRequestDispatcher("/first.html");
			rd.forward(request, response);
			return ;
		}else if(password == null || password.isBlank() ){
			response.sendRedirect("https://www.daum.net");
			return ;
		}
		
		out.print("<h1>"+client+"ë‹˜ì˜ ì˜ˆì•½ë‚´ìš©</h1><br><hr><br>");
		out.print("<ol><li>ë£¸ : "+room+"</li>");
		out.print("<li>ì¶”ê°€ ìš”ì²­ ì‚¬í•­ : " + str+"</li>");
		out.print("<li>ì˜ˆì•½ë‚ ì§œ: " + date+"</li>");
		
		out.print("<br><br><a href='"+request.getHeader("referer")+"'>ì…ë ¥í™”ë©´ìœ¼ë¡œ ê°€ê¸°</a>");
		out.close();
	}

}
```


</div>
</details>
  
  ## ğŸ¤·â€â™€ï¸ todayâ€™s feeling

- êµìœ¡ì „ ë¶€ì¡±í•œ ê°œë…ìœ¼ë¡œ session ê´€ë¦¬ë¥¼ í´ë¼ì´ì–¸íŠ¸ ë‹¨ì—ì„œ ì²˜ë¦¬í•˜ëŠ” ì¤„ ì•Œì•˜ë‹¤..! â†’ session ì €ì¥ì€ ì„œë²„ì—ì„œ
- ì˜¤ëŠ˜: redirect,forwardì‹¤ìŠµ ,ë‚´ì¼ session ì‹¤ìŠµ í•˜ê¸°
- ì‹¤ìŠµì´ ì ì  ìœµë³µí•©ì ì¸ ì‹¤ìŠµì´ë¼ ì´ ì „ ë°°ì› ë˜ ë‚´ìš© ë³µìŠµì´ ì ì  ë” ì¤‘ìš”í•´ ì§„ë‹¤.. â†’ ì£¼ë§ ê³µë¶€ í•„ìš”..
- íŒ€íšŒì˜ ë•Œ ë¡œê·¸ì¸ ì²˜ë¦¬ ë°©ì‹ì„ jwtë¡œ í•˜ê¸°ë¡œ í•¨ â†’ jwt ê³µë¶€í•˜ê¸°
- 2023-04-12 : ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ íŒ€ ì²« íšŒì˜(ì˜ê²¬ì„ ë‹¤ ê°™ì´ ë§ì´ ë‚´ì„œ ë¹ ë¥´ê²Œ ì§„í–‰ ë˜ì—ˆë‹¤. )
