<img src="https://noticon-static.tammolo.com/dgggcrkxq/image/upload/v1566778017/noticon/ytjm1rralodyhvuggrpu.png" height="15%" width="15%"> <br/>

# 2023-04-27 / Mybatis

ğŸ—“ï¸ ë‚ ì§œâ€â€â€â€â€â€â€â€â€â€â€2023/04/27 

â˜ï¸ ë‚ ì”¨â€â€â€â€â€â€â€â€â€â€ ğŸŒ¥ï¸ íë¦¼ (10Â°C)
</br>

## 01. MVC êµ¬í˜„ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì–´ë…¸í…Œì´ì…˜

<img src="https://user-images.githubusercontent.com/55836020/235099354-14350fbf-26e3-4247-ad5c-dda33c712e8d.png" width="50%" />

- ì»¨íŠ¸ë¡¤ëŸ¬ : @Controller,í”„ë ˆì  í…Œì´ì…˜ ë ˆì´ì–´, ì›¹ ìš”ì²­ê³¼ ì‘ë‹µì„ í…œí”Œë¦¿ì„ í†µí•´ ë˜ëŠ” ì§ì ‘ ì²˜ë¦¬í•œë‹¤.
- ë¡œì§ ì²˜ë¦¬ : @Service, ì„œë¹„ìŠ¤ ë ˆì´ì–´, í•„ìš”ì‹œ ë‚´ë¶€ì—ì„œ ë¹„ì§€ë‹ˆìŠ¤ ë¡œì§ì„ ì²˜ë¦¬í•¨
- ì™¸ë¶€I/O ì²˜ë¦¬ :@Repository, í¼ì‹œìŠ¤í„´ìŠ¤ ë ˆì´ì–´, DBë‚˜ íŒŒì¼ê°™ì€ ì™¸ë¶€ I/O ì‘ì—…ì„ ì²˜ë¦¬í•¨

## 02. Model1 VS Model2

### 2.1 Model1

- jspë¡œ êµ¬í˜„í•˜ë˜ ì‹œì ˆ viewì™€ logicì„ jsp í˜ì´ì§€ í•˜ë‚˜ì—ì„œ ì²˜ë¦¬í•˜ëŠ” êµ¬ì¡°
- ê³µí†µëœ ë¶€ë¶„ì„ java í´ë˜ìŠ¤ë¡œ ë¹¼ì„œ ì‚¬ìš©í•œê²Œ jsp ìš© java beans(module)ë¥¼ ì‚¬ìš©
- Front,Back ì´ í˜¼í•©ë˜ì–´ ìˆì–´ ë¶„ì—…ì´ í˜ë“¤ë‹¤.

### 2.2 Model2

- MVC íŒ¨í„´ì„ ì›¹ê°œë°œì— ë„ì…í•œ êµ¬ì¡°
- Clientì²˜ë¦¬ëŠ” Servlet ,  logic ì²˜ë¦¬ëŠ” java class, clinetì—ê²Œ ì¶œë ¥ì€ JSPê°€ ë‹´ë‹¹
- Front,backì´ ë¶„ë¦¬ë˜ì–´ ë¶„ì—…ì´ ìš©ì´


## 03. MyBatis ë€?

ğŸ’¡ DB ì—°ë™ êµ¬í˜€ì‹œ ì‚¬ìš©ë˜ëŠ” ìë°” í¼ì‹œìŠ¤í„´ìŠ¤ í”„ë ˆì„ì›Œí¬ë¡œ SQL Mapper íŒŒì¼ ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.(ì„ ì–¸ì  í”„ë¡œê·¸ë˜ë°)

- JDBCë¡œ ì²˜ë¦¬í•˜ëŠ” ìƒë‹¹ë¶€ë¶„ì˜ ì½”ë“œì™€ íŒŒë¼ë¯¸í„° ì„¤ì • ë° ê²°ê³¼ ë§¤í•‘ì„ mabatisê°€ ëŒ€ì‹ í•´ ì¤€ë‹¤.
- ë‚´ë¶€ì ìœ¼ë¡œ JDBCë¥¼ ì‚¬ìš©í•œë‹¤.

### 3.1 SQL ì •ì˜ ë°©ë²•

1. ë§¤í•‘ íŒŒì¼ : ì „í†µì ì¸ ë°©ë²•ìœ¼ë¡œ, ë§ˆì´ë°”í‹°ìŠ¤ ê¸°ëŠ¥ì„ ì™„ë²½í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆë‹¤.
2. ì• ë…¸í…Œì´ì…˜ : Mybatis3ë¶€í„° ì§€ì›ë˜ëŠ” ë°©ë²•ìœ¼ë¡œ, ê°œë°œì˜ ìš©ì´ì„±ì„ ìš°ì„ ì‹œí•  ë•Œ íš¨ê³¼ì ì´ë‹¤. ë³µì¡í•œ SQLì´ë‚˜ ë§¤í•‘ì„ ì§€ì •í•  ë•Œ ì í•©í•˜ì§€ ì•Šë‹¤.

### 3.2 Mabatis ì²˜ë¦¬ íë¦„

<img src="https://user-images.githubusercontent.com/55836020/235100895-44c41903-5272-419d-9772-74f093ad1392.png" width="50%"/>

- Application, Mapping File ì€ êµ¬í˜„í•´ì•¼í•  ë¶€ë¶„
- ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ â†’ SqlsessionFactoryBuilderê°€ MyBatis ì„¤ì • íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ SqlSessionFactoryë¥¼ ìƒì„± â†’ë°ì´í„° ì ‘ê·¼ ì‘ì—…ì‹œ SqlSessionFactoryëŠ” ë§¤ ìš”ì²­ë§ˆë‹¤ SqlSessionê°ì²´ ìƒì„± â†’ (SqlSessionìœ¼ë¡œ DB ì ‘ê·¼)
>

## 04. SqlSession

ğŸ’¡ SQL ë°œí–‰ì´ë‚˜ íŠ¸ëœì­ì…˜ ì œì–´ìš© APIë¥¼ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë‹¤.

- ë§ˆì´ë°”í‹°ìŠ¤ë¥¼ ì´ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ë•Œ ê°€ì¥ ì¤‘ìš”í•œ ì—­í• ì„ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ë‹¤.
- ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ë§ˆì´ë°”í‹°ìŠ¤ ì¸¡ì˜ íŠ¸ëœì­ì…˜ ì œì–´ APIëŠ” tì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. SqlSessionì´ MapperíŒŒì¼ì—ì„œ SQLì„ ìˆ˜í–‰í•˜ê³  SQLì„ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

```
T selectOne(String statement, Object parameter)
T selectOne(String statement)
List<E> selectList(String statement, Object parameter) 
List<E> selectList(String statement)
int insert(String statement, Object parameter)
int insert(String statement)
int delete(String statement, Object parameter)
int delete(String statement)
int update(String statement, Object parameter)
int update(String statement)
```

- ì œë„ˆë¦­ íƒ€ì…ìœ¼ë¡œ ë¦¬í„´ê°’ì„ ì œì–´ í•  ìˆ˜ ìˆë‹¤.
- delete,update,insertì˜ ë¦¬í„´ íƒ€ì…ì€ intë¡œ ë³€ê²½ëœ ë°ì´í„° ê°¯ìˆ˜ì´ë‹¤.
- namespace ë‚´ idëŠ” ìœ ë‹ˆí¬ í•´ì•¼ í•œë‹¤,

### 4.2 ì˜ˆì œ

- EmpMapper.xml

```xml
<mapper namespace="testdb">
	<select id="countEmp"  resultType="int">
		select count(*) from emp
	</select>
	<select id="selectEmp"  resultType="EmpVO">
		select empno, ename, job, date_format(hiredate, '%Yë…„ %mì›” %dì¼') hiredate, sal  from emp
	</select>
	<select id="partEmp"  resultType="EmpVO" parameterType="PageDTO"  >
		select empno, ename, job, date_format(hiredate, '%Yë…„ %mì›” %dì¼') hiredate, sal from emp order by sal limit #{startNum}, #{countNum}
	</select> 	
</mapper>
```

- EmpDAO.java

```java
@Repository
public class EmpMybatisDAO {
	@Autowired
	SqlSession session;	
	public int getAllDataNum() {		
		String statement = "testdb.countEmp"; // namespace.id
		int num = session.selectOne(statement);
		return num;
	}
	
	public List<EmpVO> listAll() {
		String statement = "testdb.selectEmp";
		List<EmpVO> list = session.selectList(statement);
		return list;
	}
	
	public List<EmpVO> listPart(PageDTO vo) {
		String statement = "testdb.partEmp";
		vo.setCountNum(vo.getEndNum()-vo.getStartNum()+1);
		List<EmpVO> list = session.selectList(statement, vo);
		return list;
	}
}
```

## 05. MyBatis ì„¤ì¹˜

1. build.gradleì˜ dependecies í•­ëª©ì— API ì¶”ê°€
    - implementation 'org.mybatis.spring.boot:mybatis-spring-boot-starter:2.3.0â€™
    - ë˜ëŠ” spring initializrì— depedencies ì„¤ì •ì— MyBatis ì •ë³´ ì„ íƒ
2. application,properties íŒŒì¼ì— DB ì •ë³´ ì¶”ê°€ 
    
    ```
    # database ì •ë³´ ì…ë ¥
    spring.datasource.url: DB_URL
    spring.datasource.username: 
    spring.datasource.password: 
    spring.datasource.driver-class-name: 
    
    # mybatis
    mybatis.mapper-locations: mybatis/mapper/*.xml -> mapperíŒŒì¼ì˜ ê²½ë¡œ
    mybatis.type-aliases-package=com.example.springedu.domain  -> ë§¤í¼ íŒŒì¼ì—ì„œ ì‚¬ìš©í•  í´ë˜ìŠ¤ë“¤ì˜ íŒ¨í‚¤ì§€ í´ë” ê²½ë¡œ
    ```

## ê¸°íƒ€

- springì—ì„œ java íŒŒì¼ ë¹¼ê³ ëŠ” resource íŒŒì¼ì— ìˆì–´ì•¼ í•¨.
- classë‚´ ê°ì²´ë¥¼ ì ‘ê·¼ í•´ì•¼ í•  ë•Œ, ì¦‰ beanì„ ì‚¬ìš©í•´ì•¼ í• ë•Œ ê°ì²´ ì„ ì–¸ + @Autowired
- @Data : getter,setter,constructor ìƒì„±í•´ì¤Œ







## Exercise01 / @PathVariable

<details>
<summary>ğŸ“œredirect,forward ì‹¤ìŠµ í¼ì³ë³´ê¸°</summary>
<div markdown="1">

1ï¸âƒ£ **[ì‹¤ìŠµ 1]**

## Exercise01+02 /mybatis

1ï¸âƒ£  ì‹¤ìŠµ íŒŒì¼

[4ì›”27ì¼ì‹¤ìŠµ_1.pdf](https://github.com/juhee99/Msa-Dkteckin-fullstack/files/11363291/4.27._1.pdf)

[4ì›”28ì¼ì‹¤ìŠµ_1.pdf](https://github.com/juhee99/Msa-Dkteckin-fullstack/files/11363292/4.28._1.pdf)

1. **bookMapper.xml**

```xml
<mapper namespace="lab1">
    <!--1.ëª¨ë‘ ì¶œë ¥í•˜ê¸°-->
    <select id="exam1" resultType="BookDTO" >
        select id, title, price, kind from book
    </select>
    <select id="exam2" resultType="BookDTO">
        select id, title, price, kind from book order by price desc
    </select>
    <select id="exam3" resultType="BookDTO">
        select id, title, price, kind from book where price >= 20000 order by price desc
    </select>
    <select id="exam4" resultType="BookDTO">
        select id, title, price, kind from book where kind = 'b02'
    </select>
    <select id="exam5" resultType="BookDTO">
        select id, title, price, kind from book where kind = 'b04' or kind = 'b05'
    </select>
    <select id="exam6" parameterType="java.lang.String" resultType="BookDTO">
        select id, title, price, kind from book where title like '%${keyword}%'
    </select>
    <select id="exam7" resultType="BookVO">
        select kind, round(avg(price)) as priceAvg from book group by kind
    </select>
    <insert id="createBook" parameterType="BookDTO">
        insert into book (title, price, kind) values (#{title}, #{price}, #{kind})
    </insert>

</mapper>
```

1. BookDAO.java

```java
@Repository
public class BookMybatisDAO {
   @Autowired
    SqlSession session;

   public List<BookDTO> b1(){
       List<BookDTO> allList = null;
       try{
           allList = session.selectList("lab1.exam1");
       }catch (Exception e){
           e.printStackTrace();
       }
       return allList;
   }

    public List<BookDTO> b2(){
        List<BookDTO> allList = null;
        try{
            allList = session.selectList("lab1.exam2");
        }catch (Exception e){
            e.printStackTrace();
        }
        return allList;
    }

   public List<BookDTO> b3() {
       List<BookDTO> list = null;
       try{
           list=session.selectList("lab1.exam3");
       }catch (Exception e){
           e.printStackTrace();
       }
       return list;
   }

   public List<BookDTO> b4(){
       List<BookDTO> list = null;
       try{
           list=session.selectList("lab1.exam4");
       }catch (Exception e){
           e.printStackTrace();
       }
       return list;
   }

    public List<BookDTO> b5(){
        List<BookDTO> list = null;
        try{
            list=session.selectList("lab1.exam5");
        }catch (Exception e){
            e.printStackTrace();
        }
        return list;
    }

    public List<BookDTO> b6(){
        List<BookDTO> list = null;
        try{
            list=session.selectList("lab1.exam6","ìë°”");
        }catch (Exception e){
            e.printStackTrace();
        }
        return list;
    }

    public List<BookDTO> b7(){
        List<BookDTO> list = null;
        try{
            list=session.selectList("lab1.exam6","ìŠ¤í”„ë§");
        }catch (Exception e){
            e.printStackTrace();
        }
        return list;
    }
    public List<BookVO> b8(){
        List<BookVO> list = null;
        try{
            list=session.selectList("lab1.exam7");
        }catch (Exception e){
            e.printStackTrace();
        }
        return list;
    }

    public boolean insert(BookDTO dto) {
       boolean result = true;
       if(session.insert("lab1.createBook",dto) != 1){
           result=false;
       }
       return result;
    }
}
```

1. bookPage.html

```html
<body>
<h2>ì±… ì •ë³´ ì¶œë ¥</h2>
<hr>
<a href = "/bookinfo/b1"><button>ëª¨ë“  ë„ì„œ</button></a>
<a href = "/bookinfo/b2"><button>ê°€ê²©ì´ ë†’ì€ ìˆœìœ¼ë¡œ</button></a>
<a href = "/bookinfo/b3"><button>ê°€ê²©ì´ 20000ì› ë³´ë‹¤ ë†’ì€ ë„ì„œ</button></a>
<a href = "/bookinfo/b4"><button>ì›¹í”„ë¡œê·¸ë˜ë° ë„ì„œ</button></a>
<a href = "/bookinfo/b5"><button>ë°ì´í„°ë² ì´ìŠ¤ì™€ ì¸í”„ë¼ ë„ì„œ</button></a>
<a href = "/bookinfo/b6"><button>ë„ì„œëª…ì— ìë°”ë¥¼ í¬í•¨í•˜ëŠ” ë„ì„œ</button></a>
<a href = "/bookinfo/b7"><button>ë„ì„œëª…ì— ìŠ¤í”„ë§ì„ í¬í•¨í•˜ëŠ” ë„ì„œ</button></a>
<a href = "/bookinfo/b8"><button>ë¶„ë¥˜ë³„ ë„ì„œ ê°€ê²©ì˜ ë²Œê¸ˆ</button></a>
<a href = "/bookCreate" ><button>ë„ì„œ ì¶”ê°€</button></a>
<hr>
<div>
    <table th:if="${list}">
        <tr>
           <th>id</th>
            <th>title</th>
            <th>price</th>
            <th>kind</th>
        </tr>
        <tr th:each="data : ${list}">
            <td>[[${data.id}]]</td>
            <td>[[${data.title}]]</td>
            <td>[[${data.price}]]</td>
            <td>[[${data.kind}]]</td>
        </tr>
    </table>

    <th:block th:if="${avglist}">
        <ol th:each="data : ${avglist}">
            <li th:text="| ${data.kind}ì˜ ë„ì„œë“¤ì˜ ê°€ê²© í‰ê· ì€ ${data.priceAvg} ì…ë‹ˆë‹¤.|"></li>
        </ol>
    </th:block>

    <h3 th:if="${msg}" th:text="${ msg }"></h3>

</div>

</body>
</html>
```

1. bookCreatePage.html

```html
<body>
<th:block th:if="${newBook}">
    <h3>ì…ë ¥ëœ ë„ì„œ ì •ë³´</h3>
    <hr>
    <div>
    <label for="title">ë„ì„œ ëª… : </label>
    <input type="text" readonly id="title" th:value="${newBook.title}" /><br>
    <label for="price">ë„ì„œ ê°€ê²© : </label>
    <input type="text" readonly id="price" th:value="${newBook.price}" /><br>
    <label for="title">ë„ì„œ ë¶„ë¥˜</label>
    <input type="text" readonly id="kind" th:value="${newBook.kind}" /><br>
    </div>
    <a href="/bookinfo/b1">ì „ì²´ ë¦¬ìŠ¤íŠ¸ ë³´ê¸°</a>

</th:block>

<th:block th:if="${msg}">
    <h3 th:text="${msg}"></h3>
</th:block>

<th:block th:unless="${newBook}">
    <h3>ë„ì„œ ì •ë³´ ì…ë ¥</h3>
    <hr>
    <form action="/bookCreate" method="post" >
        <label for="inputTitle">ë„ì„œëª… : </label>
        <input type="text" id="inputTitle" name="title" required/>
        <br>
        <label for="inputPrice" >ê°€ê²© : </label>
        <input type="number" id="inputPrice" name="price" required/><br>
        <label for="inputKind">ë„ì„œ ë¶„ë¥˜ : </label>
        <select name="kind" id="inputKind" required>
            <option value="b01"> í”„ë¡œê·¸ë˜ë° ì–¸ì–´</option>
            <option value="b02"> ì›¹ í”„ë¡œê·¸ë˜ë°</option>
            <option value="b03">ë¹…ë°ì´í„°</option>
            <option value="b04">ë°ì´í„°ë² ì´ìŠ¤</option>
            <option value="b05">ì¸í”„ë¼</option>
        </select>
        <input type="submit" value="ë„ì„œ ì¶”ê°€"/>
    </form>
</th:block>

</body>
```

</div>
</details>

## ğŸ¤·â€â™€ï¸ todayâ€™s feeling

- íŒŒì¼ ì—…ë¡œë“œ â†’ ë¯¸ë‹ˆ í”„ë¡œì íŠ¸ ë•Œ  í”„ë¡œí•„ ì—…ë¡œë“œ ì‹œ ì‚¬ìš©
- PathVariable ë™ì ìœ¼ë¡œ ê²½ë¡œë¥¼ ì„¤ì •í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ìì£¼ ì‚¬ìš©í• ê±° ê°™ë‹¤.
