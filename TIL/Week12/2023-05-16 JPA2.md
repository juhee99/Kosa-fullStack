<img src="https://noticon-static.tammolo.com/dgggcrkxq/image/upload/v1566778017/noticon/ytjm1rralodyhvuggrpu.png" height="15%" width="15%"> <br/>

# 2023-05-16 / JPA2

ğŸ—“ï¸ ë‚ ì§œâ€â€â€â€â€â€â€â€â€â€â€2023/05/16

â˜ï¸ ë‚ ì”¨â€â€â€â€â€â€â€â€â€â€â€â˜€ï¸ ë§‘ìŒ (21 Â°C)

## 01. JPA ì—°ê´€ê´€ê³„ ë§¤í•‘

ğŸ’¡ ì—”í‹°í‹°ëŠ” ë‹¤ë¥¸ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ì¡´ì¬í•œë‹¤.(ë‹¨ë°©í–¥, ì–‘ë°©í–¥)

### 1.1 ë‹¤ëŒ€ì¼(N:1) ì—°ê´€ê´€ê³„ - ë‹¨ë°©í–¥

- í…Œì´ë¸”ì€ì™¸ë˜í‚¤ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºì§€ë§Œ ê°ì²´ëŠ” `ì°¸ì¡°(ì£¼ì†Œ)`ë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ”ë‹¤
- ì°¸ì¡°ë¥¼ í†µí•œ ê°ì²´ ì—°ê´€ê´€ê³„ëŠ” ì–¸ì œë‚˜ ë‹¨ë°©í–¥ì´ë¼ëŠ” ê²ƒ ì´ë‹¤.
- N : @JoinColumn(name = â€œì™¸ë˜ í‚¤ ì»¬ëŸ¼ ëª… â€œ)
    - í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ ë§¤í•‘ì‹œ ì‚¬ìš©
- N : @ManyToOne
    - : ì—°ê´€ ê´€ê³„ ë§¤í•‘ ì–´ë…¸í…Œì´ì…˜
- 1 : @Column(name = â€œprimaryí‚¤ ì»¬ëŸ¼ ëª…â€)
    - í…Œì´ë¸”ì˜ primary key ì»¬ëŸ¼ ì§€ì •
    - ê°€ê¸‰ì ì´ë©´ ëª…í™•í•˜ê²Œ ì§€ì •í•˜ëŠ” ê²ƒì´ ì¢‹ìŒ.
    

### 1.2 ì†ì„±

| ì†ì„± | ê¸°ëŠ¥ | ê¸°ë³¸ê°’ |
| --- | --- | --- |
| optional | falseë¡œ ì„¤ì •í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ ìˆì–´ì•¼ í•œë‹¤. | TRUE |
| fetch | ê¸€ë¡œë²Œ í˜ì¹˜ ì „ëµì„ ì„¤ì •í•œë‹¤. | @ManyToOne=FetchType.EAGER@OneToMany=FetchType.LAZY |
| cascade | ì˜ì†ì„± ì „ì´ ê¸°ëŠ¥ì„ ì‚¬ìš© |  |
| tartgetEntity | ì—°ê´€ëœ ì—”í‹°í‹°ì˜ íƒ€ì… ì •ë³´ë¥¼ ì„¤ì •í•œë‹¤.  | ì˜ ì‚¬ìš© ì•ˆí•¨ |

### [ ì˜ˆì œ ]

<img src="https://github.com/juhee99/Kosa-fullStack/assets/55836020/711ddb39-51ac-485f-aa21-dc180d2dc7f8" width="50%"/>

ğŸ“— **Member.java**

```java
@Entity
public class Member {
	@Id
	@Column(name = "MEMBER_ID")
	@GeneratedValue(strategy = GenerationType.IDENTITY)
	private int id;
	private String username;
	// ì—°ê´€ê´€ê³„ ë§¤í•‘
	@ManyToOne
	@JoinColumn(name = "TEAM_ID")
	private Team team;
}
```

- ê°ì²´ì˜ Member.teamí•„ë“œì™€ íšŒì› í…Œì´ë¸” Member.TEAM_ID ì™¸ë˜í‚¤ ì»¬ëŸ¼ì´ ë§¤í•‘

ğŸ“™ **Team.java**

```java
public class Team {
	@Id
	@Column(name = "TEAM_ID")	
	private String id;
	private String teamName;
}
```

## Exercise01 / MVC íŒ¨í„´ì˜ JPA

<details>
<summary> ğŸ“œMVC íŒ¨í„´ì˜ JPA ì‹¤ìŠµ í¼ì³ë³´ê¸°</summary>
<div markdown="1">


[5ì›”16ì¼_1.pdf](https://github.com/juhee99/Kosa-fullStack/files/11514904/5.16._1.pdf)

1ï¸âƒ£ Student.java

```java
@Entity
public class Student {
    @Id
    private String name;
    private int score;
}
//getter,setter,toString() ìƒëµ
```

2ï¸âƒ£ StudentDAO.java

```java
public class StudentDAO {
    private  EntityManagerFactory factory;
    public StudentDAO(){
        super();
        factory = Persistence.createEntityManagerFactory("entitytest");
    }

    public boolean insertStudent(Student entity) {
        boolean result=true;
        EntityManager em = factory.createEntityManager();
        try {
            em.getTransaction().begin();
            em.persist(entity);
            em.getTransaction().commit();
        }catch (Exception e){
            result=false;
            e.printStackTrace();
        }
        em.close();
        return result;
    }

    public List<Student> getAllStudent(){
        EntityManager em = factory.createEntityManager();
        TypedQuery<Student> q = em.createQuery("select st from Student st", Student.class);
        List<Student> list = q.getResultList();
        em.close();
        return list;
    }

   public Student getScore(String name){
       EntityManager em = factory.createEntityManager();
       Student st = em.find(Student.class,name);
       em.close();
       return st;
    }

   public boolean updateStudent(Student entity){
        boolean result = true;
        EntityManager em = factory.createEntityManager();
        try {
            em.getTransaction().begin();
            Student st = em.find(Student.class,entity.getName());
            st.setScore(entity.getScore());
            em.persist(st);
            em.getTransaction().commit();
        }catch (Exception e){
            result = false;
            e.printStackTrace();
        }
        em.close();
        return result;
   }

   public boolean deleteStudent(String name){
       boolean result = true;
       EntityManager em = factory.createEntityManager();
       try {
           em.getTransaction().begin();
           Student st = em.find(Student.class,name);
           em.remove(st);
           em.getTransaction().commit();

       }catch (Exception e){
           result = false;
           e.printStackTrace();
       }
       em.close();
       return result;
   }
   public void close(){
        if( factory != null) factory.close();
   }
}
```

3ï¸âƒ£ StudentApp.java

```java
public class StudentApp {
    public static void main(String[] args) {
        Scanner scan = new Scanner(System.in);
        StudentController con = new StudentController();
        String name;
        int score;

        while(true){
            System.out.println("ì²˜ë¦¬í•˜ë ¤ëŠ” ê¸°ëŠ¥ì„ ì„ íƒí•˜ì„¸ìš”.");
            System.out.println("1. í•™ìƒ ì •ë³´ ì¶œë ¥");
            System.out.println("2. í•™ìƒ ì •ë³´ ì…ë ¥");
            System.out.println("3. í•™ìƒ ì •ë³´ ì‚­ì œ");
            System.out.println("4. í•™ìƒ ì •ë³´ ìˆ˜ì •");
            System.out.println("5. í•™ìƒ ì •ë³´ í™•ì¸");
            System.out.println("6. ì¢…ë£Œ");
            System.out.print("\n\nì…ë ¥ : ");
            int num = scan.nextInt();
            scan.nextLine();

            if (num == 6){ break;
            } else if (num > 6 || num < 1) {
                System.out.println("ì˜ëª» ì…ë ¥í•˜ì…¨ìŠµë‹ˆë‹¤.");
                continue;
            }

            switch (num){
                case 1:
                    con.printAll();
                    break;
                case 2:
                    System.out.print("ì¶”ê°€ í•  í•™ìƒ ì´ë¦„ : ");
                    name = scan.nextLine();
                    System.out.print("í•™ìƒ ì ìˆ˜ : ");
                    score = scan.nextInt();
                    con.insert(name,score);
                    break;
                case 3:
                    System.out.print("ì‚­ì œí•  í•™ìƒ ì´ë¦„ : ");
                    name = scan.nextLine();
                    con.delete(name);
                    break;
                case 4:
                    System.out.print("ìˆ˜ì •í•  í•™ìƒ ì´ë¦„ : ");
                    name = scan.nextLine();
                    System.out.print("í•™ìƒ ì ìˆ˜ : ");
                    score = scan.nextInt();
                    con.update(name,score);
                    break;
                case 5 :
                    System.out.print("ì ìˆ˜ í™•ì¸í•  í•™ìƒ ì´ë¦„ : ");
                    name = scan.nextLine();
                    con.printScore(name);
            }
        }
        scan.close();
        con.close();
    }
}
```


</div>
</details>


## Exercise02 / ì—°ê´€ê´€ê³„

<details>
<summary> ğŸ“œJPAì—°ê´€ê´€ê³„ ì‹¤ìŠµ í¼ì³ë³´ê¸°</summary>
<div markdown="1">


[5ì›”16ì¼_2.pdf](https://github.com/juhee99/Kosa-fullStack/files/11514906/5.16._2.pdf)

1ï¸âƒ£ EmpDeptLab

```java
public class EmpDeptLab {
    public static void main(String[] args) {
        Scanner scan = new Scanner(System.in);
        EntityManagerFactory factory = Persistence.createEntityManagerFactory("entitytest");
        EntityManager em = factory.createEntityManager();
        String deptName;

        if(new Random().nextBoolean()){
            System.out.print("ì‚¬ì›ëª…ì„ ì…ë ¥í•˜ì„¸ìš” : ");
            String empName = scan.nextLine();
            TypedQuery<String> query = em.createQuery("select d.DNAME from emp e join e.dept d where e.ENAME = :name", String.class);
            query.setParameter("name",empName);

            try {
                deptName = query.getSingleResult();
                System.out.println(empName+" ë‹˜ì˜ ë¶€ì„œëª…ì€"+deptName+"ì…ë‹ˆë‹¤...");
            }catch(NoResultException e){
                System.out.println("ë¶€ì„œëª…ì„ ì°¾ì„ ìˆ˜ ì—†ë„¤ìš”..ã…œã…œ");
            }
        }else {
            System.out.print("ë¶€ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš” : ");
            deptName = scan.nextLine();
            TypedQuery<Emp> query = em.createQuery("select e from emp e join e.dept d where d.DNAME = :deptName", Emp.class);
            query.setParameter("deptName",deptName);
            List<Emp> list = query.getResultList();
            if (list.isEmpty()){
                System.out.println("ì§ì›ì„ ì°¾ì„ ìˆ˜ ì—†ë„¤ìš”..ã…œã…œ");
            }else{
                System.out.println(deptName+" ë¶€ì„œì—ëŠ” ì´ ì§ì›ë“¤ì´ ì†í•´ìˆì–´ìš”~~~~!");
                list.forEach(s -> {
                    System.out.println(s.getENAME()+"ë‹˜");
                });
            }
        }
        scan.close();
        em.close();
        factory.close();

    }
}
```

2ï¸âƒ£Emp.java

```java
@Entity(name = "emp")
public class Emp {

    @Id
    @Column(name = "EMPNO" )
    private int EMPNO;
    private String ENAME;
    private  String job;
    private Integer MGR;
    private Date HIREDATE;
    private int SAL;
    private Integer COMM;
    @ManyToOne
    @JoinColumn(name = "DEPTNO")
    Dept dept;
}
```

3ï¸âƒ£ Dept.java

```java
@Entity
public class Dept {

    @Id
    @Column(name = "DEPTNO")
    private int DEPTNO;
    private String DNAME;
    private String LOC_CODE;
}
```

<div>
<details>

