# 2023-03-02 / DataBase


### ë°ì´í„°ë² ì´ìŠ¤ë€?
---
í•œ ì¡°ì§ì˜ ì—¬ëŸ¬ ì‘ìš© ì‹œìŠ¤í…œë“¤ì´ ê³µìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í†µí•©í•˜ê³ ,ì €ì¥í•œ ìš´ì˜ ë°ì´í„°ì˜ ì§‘í•©ì´ë‹¤.

- Datbase Management system(DBMS)
- ì»´í“¨í„° ì‹œìŠ¤í…œê³¼ ë¬´ê´€í•˜ë‹¤

### ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤(Relational)
---
- íŠœí”Œ(Tuple) : í…Œì´ë¸”ì˜ row(í–‰)
- ë¦´ë ˆì´ì…˜(Relation): Tupleì˜ ì§‘í•©
- ì• íŠ¸ë¦¬ë·°íŠ¸(Attribute) : ë¦´ë ˆì´ì…˜ìœ¼ íŠ¹ì§•ì„ ë‚˜íƒ€ë‚´ëŠ” ë‹¨ì¼í•œ ë°ì´í„°, ì»¬ëŸ¼
- ë°ì´í„°ë² ì´ìŠ¤(DataBase) : Relationì˜ ì§‘í•©
- ë„ë©”ì¸(Domain) : íŠ¹ì • ì†ì„±ì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ê°’ì˜ ì§‘í•©


### SQL ì‹¤í–‰ ìˆœì„œ
---
FROM â†’ WHERE â†’ SELECT â†’ ORDER BY


### SELECT ëª…ë ¹ì–´
---
SELECT * FORM í…Œì´ë¸” WHERE 

<aside>
ğŸ’¡  - WHERE ì ˆ

- EXISTS - ì¡´ì¬ ì—¬ë¶€
- IS NULL/ IS NOT NULL - NULL ì—¬ë¶€
</aside>

### SQL ë‚´ì¥ í•¨ìˆ˜
---
- CONCAT - ë¬¸ìì—´ ê²°í•©
- IFNULL -ë„ì¸ì§€ ê²€ì‚¬
- DATE FORMAT(ë‚ ì§œ, â€œ%Y-%m-%dâ€) - ë‚ ì§œ ë³€í™˜
- DATE ADD(ë‚ ì§œ, INTERVAL 1 DAY)
- ROUND(NUM,ì†Œìˆ˜ì  ìë¦¿ìˆ˜)

### SQL ì„œë¸Œ ì¿¼ë¦¬
---
- ìœ„ì¹˜ì— ë”°ë¼ êµ¬ë¶„
    - ì¸ë¼ì¸ ë·° : From
    - Nested ì„œë¸Œ ì¿¼ë¦¬ : Where
    - Scalar ì„œë¸Œ ì¿¼ë¦¬ : Select

### ORDER BY

- asc - ì˜¤ë¦„ì°¨ìˆœ
- desc - ë‚´ë¦¼ì°¨ìˆœ
- select * from í…Œì´ë¸” order by ì»¬ëŸ¼1

### CASE
---
- SELECT * CASE ëŒ€ìƒ WHEN ì¡°ê±´ THEN ê²°ê³¼

### JOIN
---
- Cross Join - í…Œì´ë¸”ì˜ rowì˜ ëª¨ë“  ì¡°í•©ì´ ì¡°íšŒ
- Inner Join - Joinì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” íŠœí”Œë§Œ ì¡°íšŒ
- Oter Join - ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ì•Šë”ë¼ë„ nullê³¼ í•¨ê»˜ ì¡°íšŒëœë‹¤.
- Self Join - ìê¸° ìì‹ ê³¼ ì¡°ì¸í•œ ê²°ê³¼ê°€ ì¡°íšŒëœë‹¤.

### Index
---
ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì²˜ìŒë¶€í„° ëê¹Œì§€ ì½ê¸° ë•Œë¬¸ì— ì¡°íšŒí•  ë•Œ, ì†ë„ í–¥ìƒ¹ì„ ìœ„í•´ index ì‚¬ìš©

í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì— ëŒ€ì‘ë˜ëŠ” ë³„ë„ì˜ ê°ì²´ë¡œ ë…ë¦½ì ì¸ ì €ì¥ ê³µê°„ì„ ë³´ìœ í•´ì•¼í•¨.

ë³€ê²½.ì¶”ê°€ê°€ ì ì„ë•Œ ì‚¬ìš©.

<img src="https://user-images.githubusercontent.com/55836020/222904566-04a9d856-2a7b-4400-87eb-6baa4aa32411.png" width="60%" height="40%">

### NoSQL (Non SQL)
---
- ë¹…ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë¹„ ê´€ê³„í˜• ë°ì´í„° ë² ì´ìŠ¤ì´ë‹¤.
- ìŠ¤í‚¤ë§ˆê°€ ì—†ë‹¤.
- json íŒŒì¼ í¬ë§· - node.jsë‘ ì˜ ë¶™ìŒ

### MogoDB
---
ê´€ê³„DBì™€ Key-value ë¥¼ í†µí•©í•œ í˜•íƒœë¡œ ë‹¨ìˆœí•˜ê³  ì†ë„ê°€ ë¹ ë¥´ê³  í™•ì¥ì´ ìš©ì´í•˜ë‹¤.

- Collection -ë°ì´í„°ê°€ ì €ì¥ë˜ëŠ” ì¥ì†Œ, documentì˜ ì§‘í•©,table

### SQL ì‹¤ìŠµ ì½”ë“œ

```sql
use hr;
select * from employees;

alter table job_history 
add primary key(employee_id, start_date);

#ì„±,ëª…, ê¸‰ì—¬, ì…ì‚¬ì¼ì, ë¶€ì„œ ë²ˆí˜¸ë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.
select first_name , last_name, salary, hire_date, department_id from employees;

# ë¶€ì„œëª…ë„ ì¶œë ¥í•˜ì‹œì˜¤ -> joinìœ¼ë¡œ ì—°ê²°í‚¤ë¥¼ ì°¾ì•„ì•¼í•¨

#ì»¤ë¯¸ì…˜ì„ ë°›ëŠ” ì§ì› ì¡°íšŒ comistion_pst
#commission_pct ì»¬ëŸ¼ì´ ë„ì´ ì•„ë‹Œ ê²½ìš°ë¡œ ì¡°íšŒ -> is not null ì—°ì‚°ì ì‚¬ìš©
select *
from employees
where commission_pct is not null;

#í•œë²ˆì´ë¼ë„ ë¶€ì„œë‚˜ ì§ë¬´ë¥¼ ë³€ê²½í•œ ì ì´ ìˆëŠ” ì§ì›ì„ ì¡°íšŒ
#í•œë²ˆì´ë¼ë„ ì£¼ë¬¸í•œ ì ì´ ìˆëŠ”, í•œë²ˆì´ë¼ë„ íœ´í•™í•œ ì ì¸ í•™ìƒ
#exists ì—°ì‚°ìë¥¼ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

select * from employees
where (department_id = 70 or department_id = 80) and last_name like 'k%'
order by 1 desc
;

#ì´ë©”ì¼ ì£¼ì†Œ ì¤‘ kosa.go.krì„ ë„£ì–´ì„œ => concat
#ì´ë©”ì¼ ì£¼ì†Œ ì¤‘ 5ìë¦¬ë§Œ => substr

select 12345.678 ,round(12345.678,2), round(12345.678,-2) ;

select now() , sysdate() ;

# ì˜¤ëŠ˜ ë¶€í„° 100ì¼í›„,
# ì˜¤ëŠ˜ ë¶€í„° 1ë…„í›„

select date_add(now(),interval 100 day) , date_format(now(), '%m-%d-%Y');
select last_name, hire_date,date_format(hire_date,'%m-%d-%y')
from employees;

#ì—°ë´‰ì„ ì¶œë ¥ , ë‹¨ ì»¤ë¯¸ì…˜ì„ ë°˜ì˜í•˜ì—¬
select salary, commission_pct, salary*(1+ifnull(commission_pct,0))*12,last_name from employees;

#ì„±ëª…,ì´ë©”ì¼ì£¼ì†Œ,ì—°ë´‰,ì…ì‚¬í›„ 30ì£¼ë…„ ì¼ì,ê·¼ì†ë…„ìˆ˜(ì†Œìˆ˜2ìë¦¬ê¹Œì§€),ì…ì‚¬ì¼ìë¥¼ ì¶œë ¥í•˜ì‹œì˜¤alter
#ì„±ëª…ì€ ë¶™ì—¬ì„œ ì¶œë ¥í•©ë‹ˆë‹¤.
#ì´ë©”ì¼ ì£¼ì†ŒëŠ” @kosa.comì„ ë¶™ì…ë‹ˆë‹¤.
#ì—°ë´‰ì€ ì»¤ë¯¸ì…˜ì„ ë°˜ì˜í•˜ê³ ,ê¸‰ì—¬ì˜ 12ë°°

select concat(last_name ," ",first_name) as name, concat(email,'@kosa.com') as email , truncate(salary*(1+ifnull(commission_pct,0))*12*1240, -3) as salary ,
date_format(hire_date,'%d-%m-%Y') as hireDate, date_format(date_add(hire_date, interval 30 year),'%d-%m-%Y') as anniversary 
 from employees
 where department_id = 80
 order by hire_date asc;
 

 select department_id,count( *)
 from employees 
 group by department_id
 having count(*) > 1;
 
 
 select last_name, salary , 
 case when salary < 5000 then 'D'
	  when salary < 7000 then 'C'
      when salary < 10000 then 'B'
      when salary < 15000 then 'A'
      else 'S'
 end sal_grade
 from employees;

# ì›”ê¸‰ì„ ë“±ê¸‰ë³„ë¡œ ë‚˜ëˆ„ê³  ì¹´ìš´íŒ… , Së“±ê¸‰ì„ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
#caseë¬¸
 select 
 case when salary < 5000 then 'D'
	  when salary < 7000 then 'C'
      when salary < 10000 then 'B'
      when salary < 15000 then 'A'
      else 'S'
 end sal_grade , count(*) as cnt
 from employees
group by (case when salary < 5000 then 'D'
	  when salary < 7000 then 'C'
      when salary < 10000 then 'B'
      when salary < 15000 then 'A'
      else 'S'
 end ) , (case when salary < 5000 then 5
	  when salary < 7000 then 4
      when salary < 10000 then 3
      when salary < 15000 then 2
      else 1 
      end)
 order by (case when salary < 5000 then 5
	  when salary < 7000 then 4
      when salary < 10000 then 3
      when salary < 15000 then 2
      else 1 sw
      end);
      
      
      #ì…ì‚¬ì¼ìê°€ ê°€ì¥ ë¹ ë¥¸ ì§ì› 3ì‚¬ëŒì„ ì¶œë ¥, ê¸‰ì—¬ê°€ ê°€ì¥ ì‘ì€ 3ëª…ì„ ì¶œë ¥
      select * from employees order by hire_date asc limit 3;
      
      #ì„±, ì…ì‚¬ì¼ì , ê¸‰ì—¬, ë¶€ì„œëª… ì¶œë ¥
      #ì•„ì§ ë¶€ì„œì— ë°°ì¹˜ë˜ì§€ ì•Šì•„ì„œ ë¶€ì„œëª…ì„ ì¶œë ¥í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ëŠ” ì‚¬ë¼ì§„ë‹¤. => outer join í•„ìš”
      select last_name, hire_date,salary , d.department_name
      from employees e , departments d
      where e.department_id = d.department_id;
      
      #ì•„ì§ ë¯¸ë°°ì¹˜ ìƒíƒœì˜ ì§ì›ì€ ë¶€ì„œëª…ì—†ìŒì´ë¼ê³  ì¶œë ¥í•˜ì‹œì˜¤.
      select  last_name, hire_date,salary , ifnull(d.department_name,'ë¶€ì„œëª…ì—†ìŒ')
      from employees e left Join departments d
      on e.department_id = d.department_id;
```

### SQL ê³¼ì œ

```sql
#[ê³¼ì œ 01]ë¶€ì„œë²ˆí˜¸ ë¶€ì„œëª…,ë¶€ì„œì¥ì‚¬ë²ˆ,ë¶€ì„œì¥ì…ì‚¬ì¼ìë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.
    # ë‹¨ ë¶€ì„œì¥ì´ ì—†ìœ¼ë©´ ë¶€ì„œì¥ ì—†ìŒìœ¼ë¡œ ì¶œë ¥
    select d.department_id,d.department_name, ifnull(d.manager_id, 'ë¶€ì„œì¥ ì—†ìŒ') as manager_id, ifnull(e.hire_date,'ë¶€ì„œì¥ ì—†ìŒ')
    from  departments d
    left join employees e 
    on d.manager_id = e.employee_id;
    
		#teacher
    select d.department_id,d.department_name, ifnull(e.employee_id,'ë¶€ì„œì¥ ì—†ìŒ'),e.last_name,e.first_name,e.hire_date
    from employees e right join departments d on e.employee_id = d.manager_id;   
 
    #[ê³¼ì œ 02]ìì‹ ì˜ ê´€ë¦¬ìë³´ë‹¤ ë¨¼ì € ì…ì‚¬í•œ ì§ì›ì˜ ì‚¬ë²ˆ,ì„±ëª…,ì…ì‚¬ì¼ì,ê´€ë¦¬ìì…ì‚¬ì¼ìë¥¼ ì¶œë ¥í•˜ì‹œì˜¤.
    select e.employee_id, concat(e.last_name ," ",e.first_name) as name , e.hire_date , e.manager_id , m.hire_date as manager_hiredate
    from employees e
    join employees m
    on e.manager_id = m.employee_id 
    where e.hire_date < m.hire_date;
  
    
    
    #[ê³¼ì œ 03] Seattleì— ê·¼ë¬´í•˜ëŠ” ì§ì›ì˜ ì‚¬ë²ˆ,ì„±ëª…,ì…ì‚¬ì¼ì,ë¶€ì„œë²ˆí˜¸,ë¶€ì„œëª…ì„ ì¶œë ¥ -> ì„œë¸Œ ì¿¼ë¦¬ë¡œ 
 
#me
    select employee_id,  concat(last_name ," ",first_name) as name, hire_date , e.department_id ,de.department_name
    from employees e 
    join (select d.department_id ,department_name , d.location_id
    from departments d
	 	join locations l
		on d.location_id = l.location_id and l.city = 'Seattle') de
    on de.department_id = e.department_id;

#teacher
select e.employee_id, e.last_name,e.hire_date, e.department_id, 
(select department_name from departments where department_id = e.department_id) dept_name 
    from employees e
    where department_id in (select department_id from departments
								where location_id in (select location_id from locations where city='Seattle'));
```

### MogoDB ì‹¤ìŠµ
---
1. person.json íŒŒì¼ ì—…ë¡œë“œ

![mogo1](https://user-images.githubusercontent.com/55836020/222904583-e1e7b545-c3a9-4531-acfc-36bc403cf982.png)

1. DB ì—´ì–´ë³´ê¸° â†’ í…Œì´ë¸”(ì½œë ‰ì…˜) ì¡°í¬

![mogo2](https://user-images.githubusercontent.com/55836020/222904608-e450efb5-e828-4ee8-b0e5-a1123c4e359d.png)

3.ì¸ë±ìŠ¤ ìƒì„± ë° ì¸ë±ìŠ¤ ì¡°íšŒ

![mogo3](https://user-images.githubusercontent.com/55836020/222904636-e54aebf1-e91e-4029-b552-8389077b55f3.png)
